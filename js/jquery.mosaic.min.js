!function($){$.Mosaic=function(e,t){var i,s,a=this;a.el=e,a.$el=$(e),a.$el.data("Mosaic",a);var h=!1;a.init=function(){a.options=i=$.extend({},$.Mosaic.defaults,a.$el.data(),t),$(a.el).addClass("jQueryMosaic"),i.outerMargin&&$(a.el).css("padding",i.outerMargin),i.innerGap&&$(a.el).css("margin-bottom",-1*i.innerGap),a.getItems().each((function(e,t){$(t).attr("width")&&$(t).width($(t).attr("width")),$(t).attr("height")&&$(t).height($(t).attr("height"))})),a.fit(),i.refitOnResize&&$(window).on("resize",null,null,(function(){i.refitOnResizeDelay?(h&&clearTimeout(h),h=setTimeout((function(){a.fit()}),i.refitOnResizeDelay)):a.fit()}))},a.getItems=function(){return $("> div:not([data-no-mosaic=true]), > a:not([data-no-mosaic=true]), > img:not([data-no-mosaic=true])",a.el)},a.getItemAtIndex=function(e){return!!a.getItems()[e]&&$(a.getItems()[e])},a.getItemsSubset=function(e,t){var i=a.getItems();return t||(t=i.length-e),!(e>i.length)&&(e+t>i.length&&(t=i.length-e),i.slice(e,e+t))},a.isLastItemsSubset=function(e,t){var i=a.getItems();return e>i.length||e+t>i.length},a.getItemWidth=function(e){return $(e).outerWidth()?$(e).outerWidth():$(e).attr("width")?$(e).attr("width"):void 0},a.getItemHeight=function(e){return $(e).outerHeight()?$(e).outerHeight():$(e).attr("height")?$(e).attr("height"):void 0},a.getItemAspectRatio=function(e){if($(e).data("aspect-ratio"))return $(e).data("aspect-ratio");if(a.getItemWidth(e)&&a.getItemHeight(e)){var t=a.getItemWidth(e)/a.getItemHeight(e);return $(e).data("aspect-ratio",t),t}return i.defaultAspectRatio},a.getItemWidthForGivenHeight=function(e,t){return t*a.getItemAspectRatio(e)},a.getItemHeightForGivenWidth=function(e,t){return t/a.getItemAspectRatio(e)},a.setItemSizeByGivenHeight=function(e,t,i){var s=Math.floor(a.getItemWidthForGivenHeight(e,t));return $(e).width(s+"px"),i?$(e).height("auto"):$(e).height(Math.floor(t)),a.handleHighResForItem(e),s},a.handleHighResForItem=function(e){if(i.highResImagesWidthThreshold&&$(e).width()>i.highResImagesWidthThreshold){var t=$("[data-high-res-background-image-url]",e);$(e).data("high-res-background-image-url")&&(t=$(t).add(e)),$(t).each((function(){$(this).css("background-image",'url("'+$(this).data("high-res-background-image-url")+'"'),$(this).addClass("highRes")})),t=$("[data-high-res-image-src]",e),$(e).data("high-res-image-src")&&(t=$(t).add(e)),$(t).each((function(){$(this).attr("src",$(this).data("high-res-image-src")),$(this).addClass("highRes")}))}},a.calculateHeightToFit=function(e){var t=0;return e.each((function(){t+=parseFloat(a.getItemAspectRatio(this))})),(s-i.innerGap*(e.length-1))/t},a.retrieveBaseWidth=function(){var e=parseFloat($(a.el).width());s=$.isNumeric(e)?e:0},a.isBelowResponsiveWidthThreshold=function(){return i.responsiveWidthThreshold&&s<i.responsiveWidthThreshold},a.fit=function(){if(a.retrieveBaseWidth(),a.isBelowResponsiveWidthThreshold()){var e=a.getItems();return i.maxItemsToShowWhenResponsiveThresholdSurpassed&&($(e).slice(i.maxItemsToShowWhenResponsiveThresholdSurpassed).remove(),e=$(e).slice(0,i.maxItemsToShowWhenResponsiveThresholdSurpassed)),void e.each((function(){var e=a.getItemHeightForGivenWidth(this,s);$(this).width(s),$(this).data("only-force-height-when-necessary")?$(this).height("auto"):$(this).height(e),i.innerGap&&$(this).css("margin-bottom",i.innerGap)}))}for(var t=1,h=0,n=!1,o=1;;){if(e=a.getItemsSubset(h,t),a.isLastItemsSubset(h,t)){e.length&&a.fitItems(e);break}if(a.calculateHeightToFit(e)>i.maxRowHeight)t++;else{if(a.fitItems(e),h+=t,t=1,n=!0,!a.isBelowResponsiveWidthThreshold()&&i.maxRows&&o==i.maxRows)return void a.getItemsSubset(h).each((function(){$(this).hide()}));o++}}n||(i.showTailWhenNotEnoughItemsForEvenOneRow&&(i.maxRowHeightPolicy="tail"),a.fitItems(a.getItems()))},a.fitItems=function(e){var t=!1,h=a.calculateHeightToFit(e);if(h>i.maxRowHeight)switch(i.maxRowHeightPolicy){case"skip":return void e.each((function(){$(this).hide()}));case"crop":h=i.maxRowHeight;break;case"oversize":t=!0;break;case"tail":h=i.maxRowHeight;var n=!0}e.each((function(){$(this).show()}));var o=0;if(e.each((function(s){o+=a.setItemSizeByGivenHeight(this,h,t&&$(this).data("only-force-height-when-necessary")),i.innerGap&&($(this).css("margin-right",s<e.length-1?i.innerGap:0),$(this).css("margin-bottom",i.innerGap))})),!n&&o!=s-(e.length-1)*i.innerGap){difference=s-(e.length-1)*i.innerGap-o;var r=e.last().width();e.last().width(r+difference)}},a.init()},$.Mosaic.defaults={maxRowHeight:400,refitOnResize:!0,refitOnResizeDelay:!1,defaultAspectRatio:1,maxRowHeightPolicy:"skip",maxRows:!1,highResImagesWidthThreshold:350,outerMargin:0,innerGap:0,responsiveWidthThreshold:!1,maxItemsToShowWhenResponsiveThresholdSurpassed:!1,showTailWhenNotEnoughItemsForEvenOneRow:!1},$.fn.Mosaic=function(options,params){return this.each((function(){var me=$(this).data("Mosaic");(typeof options).match("object|undefined")?new $.Mosaic(this,options):eval("me."+options)(params)}))}}(jQuery);